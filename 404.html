<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting - Save Our Villages</title>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #2c5f2d 0%, #4a7c59 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
        }
        .redirect-message {
            max-width: 600px;
            padding: 2rem;
        }
        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        .spinner {
            margin: 2rem auto;
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <!-- PostHog Analytics - Loaded only with user consent -->
    <script>
        // Function to load PostHog analytics
        function loadAnalytics() {
            // Check if PostHog is already loaded
            if (window.posthog && window.posthog.__loaded) {
                console.log('PostHog already loaded');
                return;
            }

            // Load PostHog
            !function(t,e){var o,n,p,r;e.__SV||(window.posthog && window.posthog.__loaded)||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init fi Cr Or ci Tr Ir capture Mi calculateEventProperties Ar register register_once register_for_session unregister unregister_for_session Nr getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey displaySurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty jr Mr createPersonProfile Lr kr Ur opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing get_explicit_consent_status is_capturing clear_opt_in_out_capturing Fr debug M Dr getPageViewId captureTraceFeedback captureTraceMetric $r".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_bapf3RKKWohziv8014UqPW1ySks6p6NFHLbLZRPGJfz', {
                api_host: 'https://eu.i.posthog.com',
                defaults: '2025-05-24',
                person_profiles: 'identified_only'
            });

            console.log('PostHog initialized with user consent');
        }

        // Check for existing consent and track landing page
        (function() {
            try {
                // Get the original URL path that was requested
                const originalPath = window.location.pathname;
                const originalUrl = window.location.href;

                console.log('404 Page accessed - Original path:', originalPath);

                // Check for cookie consent
                const consentData = localStorage.getItem('cookieConsent');
                if (consentData) {
                    const consent = JSON.parse(consentData);
                    if (consent.analytics === true) {
                        loadAnalytics();

                        // Wait a moment for PostHog to initialize, then track the event
                        setTimeout(function() {
                            if (window.posthog) {
                                // Capture as a custom event with the original URL
                                window.posthog.capture('404_landing_page', {
                                    original_path: originalPath,
                                    original_url: originalUrl,
                                    redirect_to: '/',
                                    timestamp: new Date().toISOString()
                                });

                                // Also track as a pageview for the 404 page
                                window.posthog.capture('$pageview', {
                                    $current_url: originalUrl,
                                    page_type: '404_redirect'
                                });

                                console.log('PostHog event captured for 404 landing:', originalPath);
                            }
                        }, 500);
                    }
                }

                // Redirect to home page after 1.5 seconds (gives time for tracking)
                setTimeout(function() {
                    window.location.href = '/';
                }, 1500);

            } catch (e) {
                console.error('Error in 404 tracking:', e);
                // Still redirect even if tracking fails
                setTimeout(function() {
                    window.location.href = '/';
                }, 1500);
            }
        })();
    </script>
</head>
<body>
    <div class="redirect-message">
        <h1>Redirecting to Save Our Villages</h1>
        <div class="spinner"></div>
        <p>Taking you to the campaign homepage...</p>
    </div>
</body>
</html>
